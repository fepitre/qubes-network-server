Name:           qubes-network-server
Version:        @VERSION@
Release:        @REL@%{?dist}
Summary:        Turn your Qubes OS into a network server
BuildArch:      noarch

License:        GPLv2+
URL:            https://github.com/QubesOS-contrib/qubes-network-server
Source0:        %{name}-%{version}.tar.gz

BuildRequires:  make
BuildRequires:  coreutils
BuildRequires:  tar
BuildRequires:  findutils
BuildRequires:  python3-rpm-macros
BuildRequires:  systemd-rpm-macros

Requires:       qubes-core-agent-networking >= 4.1
Requires:       python3-qubesdb

%description
This package lets you turn your Qubes OS into a network server. Install this
in the TemplateVM of your NetVM.

Please see README.md enclosed in the package for instructions on how to use
this software.

%prep
%setup -q

%install
rm -rf $RPM_BUILD_ROOT
# variables must be kept in sync with build
make install-vm DESTDIR=$RPM_BUILD_ROOT SBINDIR=%{_sbindir} UNITDIR=%{_unitdir} PYTHON=%{__python3}

%files
%doc README.md TODO
%attr(0755, root, root) %{_sbindir}/qubes-routing-manager
%config %attr(0644, root, root) %{_unitdir}/qubes-routing-manager.service

%post
%systemd_post qubes-routing-manager.service
systemctl enable qubes-routing-manager.service

%preun
%systemd_preun qubes-routing-manager.service

%postun
%systemd_postun_with_restart qubes-routing-manager.service

%changelog
@CHANGELOG@
